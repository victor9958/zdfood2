<style>
    #LAY_adminPopupAuthority {
        height: 90%;
    }

    .centerLayer, .layui-form, .layui-tab-content {
        box-sizing: border-box;
    }

    .layui-form-item .layui-form-checkbox[lay-skin=primary] {
        margin-top: -2px;
        margin-right: 8px;
    }

    .fixedBtn {
        width: 100%;
        position: absolute;
        bottom: 0;
        left: 0;
    }

    .content-left, .content-right {
        padding: 0 15px;
    }

    .content-left {
        border-right: 1px solid #e6e6e6;
    }

    .level li {
        padding: 10px 0;
    }

    .level-two {
        margin-left: -9px;
    }

    .level-three {
        display: none;
        margin-top: 10px;
    }

    .level-three li {
        padding-left: 20px;
    }

    .level-five {
        background: #f7f8fa;
        padding: 0 10px;
        margin-top: 10px;
    }

    .level-five li {
        display: inline-block;
    }

    .centerLayer .layui-tab, .centerLayer .layui-tab-item {
        margin: 0;
    }

    .fixedTab {
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 100;
    }

    .over-auto {
        overflow: auto;
    }

    .layui-icon-right {
        transform: rotate(0deg);
        transition: transform 0.5s ease;
    }

    .child-show .layui-icon-right {
        transform: rotate(90deg);
        transition: transform 0.5s ease;
    }

    .child-show .level-three {
        display: block;
    }

    .child-content {
        display: none;
    }

    .level-three-checked {
        background: #f7f8fa;
    }

    .ellipsis{
        width: 100%;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
    }
</style>
<div class="centerLayer full-height" style="padding-bottom: 65px;">
    <script type="text/html" template lay-url="{{layui.setter.baseUrl + '/system-set/operator-permissions'}}"
            lay-data="{operatorId: layui.data('temporary').temporary,adminIdList:layui.data('temporary').adminIdList}"
            lay-done="{{layui.form.render('checkbox', 'Lay-form-authority')}}">
        <div class="layui-form full-height" id="Lay-form-authority" lay-filter="Lay-form-authority">
            <div class="layui-tab layui-form-item full-height" lay-filter="tab">
                <ul class="layui-tab-title fixedTab">
                    {{# layui.each(d.data, function(index, item){ }}
                    <li class="{{ index=== 0?'layui-this':''}}">
                        <input type="checkbox" lay-skin="primary" name="authority" value="{{ item.id }}"
                               id="node-{{ item.id }}" data-node="{{ item.id }}" title="" lay-filter="level-1" {{
                               item.isExist!=undefined?'checked=""':'' }}>
                        {{# if(item.type === 1){ }}<svg class="icon" aria-hidden="true"> <use xlink:href="#icon-caidan"></use> </svg>{{# } }}
                        {{ item.title}}
                    </li>
                    {{# }) }}
                </ul>
                <div class="layui-tab-content full-height" style="padding-top: 50px;">
                    {{# layui.each(d.data, function(index, item){ }}
                    <div class="layui-tab-item layui-tab-item-{{ item.id }} layui-clear full-height {{ index===0?'layui-show':'' }}">
                        <div class="layui-col-xs4 layui-col-sm4 layui-col-md3 content-left full-height over-auto">
                            <ul class="level level-two">
                                {{#
                                if(item.children != undefined){
                                layui.each(item.children, function(index2, item2){
                                }}

                                <li class="ellipsis level-two-option-{{ item2.id }} {{ index2===0?'child-show':''}}">
                                    <input type="checkbox" lay-skin="primary" name="authority" value="{{ item2.id }}"
                                           id="node-{{ item2.id }}" data-parent="{{ item.id }}"
                                           data-node="{{ item.id }}-{{ item2.id }}" title="" lay-filter="level-2" {{
                                           item2.isExist!=undefined?'checked=""':'' }}>
                                    {{# if(item2.type === 1){ }}<svg class="icon" aria-hidden="true"> <use xlink:href="#icon-caidan"></use> </svg>{{# } }}
                                    {{ item2.title }}
                                    {{# if(item2.children != undefined){ }}
                                    <span class="layui-icon layui-icon-right pull-right"></span>
                                    {{# } }}
                                    <ul class="level level-three">
                                        {{#
                                        if(item2.children != undefined){
                                        layui.each(item2.children, function(index3, item3){
                                        }}
                                        <li data-id="{{ item3.id }}"
                                            class="ellipsis {{ index2===0&&index3===0?'level-three-checked':'' }}">
                                            <input type="checkbox" lay-skin="primary" name="authority"
                                                   value="{{ item3.id }}" id="node-{{ item3.id }}"
                                                   data-parent="{{ item2.id }}"
                                                   data-node="{{ item.id }}-{{ item2.id }}-{{ item3.id }}" title=""
                                                   lay-filter="level-3" {{ item3.isExist!=undefined?'checked=""':'' }}>
                                            {{# if(item3.type === 1){ }}<svg class="icon" aria-hidden="true"> <use xlink:href="#icon-caidan"></use> </svg>{{# } }}
                                            {{ item3.title }}
                                        </li>
                                        {{#
                                        })
                                        }
                                        }}
                                    </ul>
                                </li>


                                {{#
                                })
                                }
                                }}
                            </ul>
                        </div>
                        <div class="layui-col-xs8 layui-col-sm8 layui-col-md9 content-right full-height over-auto">
                            {{#
                            if(item.children != undefined){
                            layui.each(item.children, function(index2, item2){
                            if(item2.children != undefined){
                            layui.each(item2.children, function(index3, item3){
                            }}
                            <div class="child-content child-content-{{ item3.id }} level-two-option-{{ item2.id }} level-three-option-{{ item3.id }} {{ index2===0&&index3===0?'layui-show':'' }}">
                                <ul class="level level-fore">
                                    {{#
                                    if(item3.children != undefined){
                                    layui.each(item3.children, function(index4, item4){
                                    }}

                                    <li>
                                        <input type="checkbox" lay-skin="primary" name="authority"
                                               value="{{ item4.id }}" id="node-{{ item4.id }}"
                                               data-parent="{{ item3.id }}"
                                               data-node="{{ item.id }}-{{ item2.id }}-{{ item3.id }}-{{ item4.id }}"
                                               lay-filter="level-4" title="" {{
                                               item4.isExist!=undefined?'checked=""':'' }}>
                                        {{# if(item4.type === 1){ }}<svg class="icon" aria-hidden="true"> <use xlink:href="#icon-caidan"></use> </svg>{{# } }}
                                        {{ item4.title }}
                                        <ul class="level level-five level-fore-option-{{ item4.id }}">
                                            {{#
                                            if(item4.children != undefined){
                                            layui.each(item4.children, function(index5, item5){
                                            }}
                                            <li>
                                                <input type="checkbox" lay-skin="primary" name="authority"
                                                       value="{{ item5.id }}" id="node-{{ item5.id }}"
                                                       data-parent="{{ item4.id }}"
                                                       data-node="{{ item.id }}-{{ item2.id }}-{{ item3.id }}-{{ item4.id }}-{{ item5.id }}"
                                                       lay-filter="level-5" title="" {{
                                                       item5.isExist!=undefined?'checked=""':'' }}>
                                                {{# if(item5.type === 1){ }}<svg class="icon" aria-hidden="true"> <use xlink:href="#icon-caidan"></use> </svg>{{# } }}
                                                {{ item5.title }}
                                            </li>
                                            {{#
                                            })
                                            }
                                            }}
                                        </ul>
                                    </li>

                                    {{#
                                    })
                                    }else{
                                    }}
                                    无四级菜单
                                    {{#
                                    }
                                    }}
                                </ul>
                            </div>
                            {{#
                            })
                            }
                            })
                            }
                            }}
                        </div>
                    </div>
                    {{# }) }}
                </div>
            </div>
        </div>
    </script>

    <div class="layui-form-item ft-center fixedBtn">
        <button class="layui-btn" id="authorityAdmin">确定</button>
        <button class="layui-btn layui-btn-primary" id="cancel">取消</button>
    </div>
</div>
<script>
    layui.use(['setting/operator', 'form'], function () {
        var $ = layui.$
            , form = layui.form
            , operator = layui.admin.operator;

        checkbox('checkbox(level-1)', '.layui-tab-item-');//一级选择操作
        checkbox('checkbox(level-2)', '.level-two-option-');//二级选择操作
        checkbox('checkbox(level-3)', '.level-three-option-');//三级选择操作
        checkbox('checkbox(level-4)', '.level-fore-option-');//三级选择操作
        checkbox('checkbox(level-5)', '');//三级选择操作

        //checkbox选择操作
        function checkbox(filter, child) {
            form.on(filter, function (data) {
                var elem_ = data.elem;//得到checkbox原始DOM对象
                var idx = data.value;//复选框value值，也可以通过data.elem.value得到
                var parent_id = $(this).data('parent');
                var flag = data.elem.checked;//是否被选中，true或者false
                var node = elem_.dataset.node;
                var nodeArr = node.split('-');
                if (child != undefined) {
                    if (flag == true) {
                        $(child + idx).find('input').prop("checked", true);
                        $.each(nodeArr, function (i, k) {
                            if (k != idx) {
                                $('#node-' + k).prop("checked", true);
                                form.render('checkbox');
                            }
                        })
                        form.render('checkbox');
                    } else {
                        $(child + idx).find('input').prop("checked", false);
                        nodeArr = nodeArr.reverse();
                        if (child != '') {
                            $.each(nodeArr, function (i, k) {
                                if (!$('#node-' + k).prop('checked') && $('#node-' + k).parent().siblings().find('>input:checked').length == 0) {
                                    $('#node-' + parent_id).prop("checked", false);
                                }
                            })
                        }

                        form.render('checkbox');
                    }
                }
            });
        }

        //三级菜单展开、收起
        $(document).off('click', '.level-two>li');
        $(document).on('click', '.level-two>li', function () {
            var elem_li = $(this).find('.level-three').find('li');//当前子菜单元素
            var li_id = elem_li.eq(0).data('id');//当前子菜单元素第一个元素data-id
            if (elem_li.length > 0) {
                $(this).toggleClass('child-show');
                $('.level-three>li').removeClass('level-three-checked');
                elem_li.eq(0).addClass('level-three-checked');
                $('.child-content-' + li_id).addClass('layui-show').siblings().removeClass('layui-show');
            }
        })

        //三级对应的四五级菜单展示
        $(document).off('click', '.level-three>li');
        $(document).on('click', '.level-three>li', function (e) {
            e.stopPropagation();
            var idx = $(this).data('id');
            $('.child-content-' + idx).addClass('layui-show').siblings().removeClass('layui-show');
            $('.level-three>li').removeClass('level-three-checked');
            $(this).addClass('level-three-checked');
        })

        $(document).off('click', '.layui-form-checkbox');
        $(document).on('click', '.layui-form-checkbox', function (e) {
            e.stopPropagation();
        })

        $(document).off('click', '#authorityAdmin');
        $(document).on('click', '#authorityAdmin', function () {
            var operatorId = layui.data('temporary').temporary;
            var adminIdList = layui.data('temporary').adminIdList;
            var permissionList = [];
            $("input:checkbox[name='authority']:checked").each(function () {
                permissionList.push($(this).val());
            });
            var field = {'operatorId': operatorId, 'adminIdList': adminIdList, 'permissionList': permissionList};
            operator.formSubmit('/system-set/admin-permissions', 'put', field, function () {
                layer.closeAll()
            })
        })

        operator.cancel();
    });
</script>
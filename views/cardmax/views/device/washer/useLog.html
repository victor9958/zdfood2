<title>使用记录</title>
<div class="layui-fluid full-height role">
    <div class="layui-row full-height">
        <div class="layui-card layui-border-box full-height flex flex-v">
            <div class="layui-card-header">使用记录</div>
            <div class="layui-card-body flex flex-v flex-1">
                <fieldset class="layui-elem-field site-demo-button">
                    <legend>搜索条件</legend>
                    <div class="layui-form">
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <div class="layui-input-inline">
                                    <script type="text/html" template
                                            lay-url="{{layui.setter.baseUrl}}/auth/operators?deviceType=1"
                                            lay-done="{{layui.form.render()}}">
                                        <select class="role" name="operatorId" lay-search>
                                            <option value="">请选择运营商</option>
                                            {{# layui.each(d.data,function(index,item){ }}
                                            <option value="{{ item.id }}">{{ item.name }}</option>
                                            {{# }) }}
                                        </select>
                                    </script>
                                </div>
                                <div class="layui-input-inline">
                                    <input type="text" id="washer-useTime" name="time" autocomplete="off" placeholder="请选择时间段" class="layui-input">
                                </div>
                                <div class="layui-input-inline">
                                    <input type="text" name="deviceNo" autocomplete="off" placeholder="请输入设备编号"
                                           class="layui-input">
                                </div>
                            </div>
                            <div class="layui-inline">
                                <button class="layui-btn" lay-submit lay-filter="search-washer-useLog">搜索</button>
                                <a href="javascript:;" class="layui-btn layui-btn-normal" lay-submit
                                   lay-filter="LAY-exportUseLog">导出数据</a>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <div class="flex-1 over-auto">
                    <div class="layui-table" id="washer-useLog" lay-filter="washerUseLog"></div>
                </div>
            </div>
        </div>

    </div>
</div>
<script type="text/html" id="washerLogOption">
    <a class="layui-btn layui-btn-xs layui-btn-primary" lay-event="detail">详情</a>
</script>

<script>
    layui.use(['device/device','table', 'form','laydate'], function () {
        var $ = layui.$,
            view = layui.view,
            table = layui.table,
            setter = layui.setter,
            form = layui.form,
            laydate = layui.laydate,
            device = layui.admin.device;

        $(function () {
            var globalQuery = {};
            laydate.render({
                elem: '#washer-useTime'
                ,range: '至'
            });

            form.render();
            device.useLog('washer-useLog',{},1)

            form.on('submit(search-washer-useLog)', function (obj) {
                globalQuery = obj.field;
                var time = globalQuery.time.split('至');
                if(time.length > 1){
                    globalQuery.beginTime = time[0];
                    globalQuery.endTime = time[1];
                }else{
                    globalQuery.beginTime = '';
                    globalQuery.endTime = '';
                }
                delete globalQuery.time;

                device.useLog('device-washer', globalQuery, 1);
            });

            device.useLogExport(1)

            table.on('tool(washerLogOption)', function (obj) {
                layui.data('temporary', {key: 'temporary', value: data.id});
                location.hash = "/device/washer/useLog/detail";
            });
        })
    });
</script>
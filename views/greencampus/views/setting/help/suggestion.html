<style>
    .feedback .add_img,.img_content{
        width: 100px;
        height: 100px;
        display: block;
        float: left;
        margin-right: 10px;
        margin-bottom: 10px;
        border: 1px solid #e6e6e6;
    }
    .feedback .add_img .icon{
        width: 30px;
        height: 30px;
        color: #999;
        margin-top: 35px;
    }
    .feedback .img_content img{
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
    }
    .feedback .img_delete{
        color: #FF4747;
        position: absolute;
        right: -6px;
        top: -6px;
    }
</style>
<title>意见建议</title>
<div class="layui-fluid full-height feedback">
    <div class="layui-card full-height flex flex-v">
        <div class="layui-card-header">意见建议</div>
        <div class="layui-card-body flex-1 over-auto">
            <div class="layui-form">
                <p class="m-b-10">请在下方填写您对系统的建议与意见：</p>
                <div class="layui-form-item layui-form-text">
                    <textarea id="feedback_content" placeholder="请输入内容" class="layui-textarea" rows="6"></textarea>
                </div>
                <p class="m-b-10">添加图片（<span id="img_count">0</span>/3）</p>
                <div class="layui-clear layui-border-box">
                    <a href="javascript:;" class="add_img ft-center">
                        <svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-shchtp"></use>
                        </svg>
                    </a>
                    <div id="img_content">

                    </div>
                </div>

                <button class="layui-btn" id="feedback_submit" style="margin-top: 40px">提交</button>
            </div>
        </div>
    </div>
</div>
<script>
    layui.use(['admin','upload','form'], function() {
        var $ = layui.$,
            admin = layui.admin,
            setter = layui.setter,
            upload = layui.upload,
            form = layui.form;

        $(function(){
            var img_count = 0;
            upload.render({
                elem: '.add_img'
                ,url: setter.baseUrl + '/public/oss-upload'
                , multiple: true
                ,before: function(obj){
                    if(img_count == 3){
                        layer.alert('最多只能上传3张图片',{icon:5});
                    }
                }
                , done: function (res) {
                    //预读本地文件示例，不支持ie8
                    if(img_count < 3){
                        $('#img_content').append('<div class="img_content relative_"><img src="' + res.data.ossUrl + '" class="layui-upload-img">' +
                            '<svg class="icon img_delete" aria-hidden="true">' +
                            '<use xlink:href="#icon-shanchu"></use></svg></div>');
                        img_count ++;
                        $('#img_count').html(img_count);
                    }
                }
            });

            //删除图片
            $(document).off('click','.img_delete');
            $(document).on('click','.img_delete',function(){
                $(this).parents('.img_content').remove();
                img_count --;
                $('#img_count').html(img_count);
            })

            //提交反馈
            $(document).off('click','#feedback_submit');
            $(document).on('click','#feedback_submit',function(){
                var imgList = [];
                var content = $('#feedback_content').val();
                $('.img_content img').each(function(){
                    imgList.push($(this).attr('src'));
                })
                if(!content){
                    layer.alert('反馈内容不能为空', {icon: 5});
                }else {
                    admin.req({
                        url: setter.baseUrl + '/help-center/feedback'
                        , type: 'post'
                        , data: {'content': content, 'imgList': imgList}
                        , done: function (res) {
                            layer.msg(res.message, {icon: 1, time: 2000});
                            layui.index.render();
                        }
                    });
                }
            })
        })

    })
</script>
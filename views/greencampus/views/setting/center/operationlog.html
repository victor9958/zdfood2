<title>操作日志</title>
<div class="layui-fluid layui-border-box full-height">
    <div class="layui-card full-height flex flex-v">
        <div class="layui-card-header fixed-header">操作日志</div>
        <div class="layui-card-body layui-clear flex-1 flex flex-v">
            <fieldset class="layui-elem-field site-demo-button">
                <legend>搜索条件</legend>
                <div class="layui-form" lay-filter="search-for-examine">
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <div class="layui-input-inline">
                                <input id="log_beginTime" type="text" name="startTime" value="" placeholder="请选择开始日期" class="layui-input">
                            </div>

                            <div class="layui-input-inline">
                                <input id="log_endTime" type="text" name="endTime" value="" placeholder="请选择结束日期" class="layui-input">
                            </div>

                            <div class="layui-input-inline">
                                <input type="text" name="queryString" autocomplete="off" placeholder="请输入账号/姓名搜索" class="layui-input">
                            </div>
                            <div class="layui-input-inline">
                                <select class="role-option" name="type" lay-search>
                                    <option value="">请选择操作类型</option>
                                    <option value="created">添加</option>
                                    <option value="deleted">删除</option>
                                    <option value="updated">修改</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-inline">
                            <button class="layui-btn" lay-submit lay-filter="LAY-search-log">搜索</button>
                        </div>
                    </div>
                </div>
            </fieldset>
            <div class="felx-1 over-auto">
                <div id="operationlog_" class="layui-table" lay-filter="operationlog_"></div>
            </div>
        </div>
    </div>
</div>
<script type="text/html" id="optionType">
    {{#  if(d.properties == 'created'){ }}
    <span>添加</span>
    {{#  } else if(d.properties == 'deleted') { }}
    <span>删除</span>
    {{#  } else { }}
    <span>更新</span>
    {{#  } }}
</script>
<script>
    layui.define(['table','form','laydate'], function(exports){
        var $ = layui.$,
            view = layui.view,
            table = layui.table,
            form = layui.form,
            admin = layui.admin,
            laydate = layui.laydate,
            setter = layui.setter;

        $(function(){
            form.render();
            tableData();

            var start = laydate.render({
                elem: '#log_beginTime',
                done: function(value, date, endDate){
                    end.config.min = {
                        year: date.year,
                        month: date.month - 1,
                        date: date.date,
                    }; //开始日选好后，重置结束日的最小日期
                    end.config.max = {
                        year: date.year,
                        month: date.month,
                        date: date.date,
                    }; //开始日选好后，重置结束日的最小日期
                }
            });

            //结束时间
            var end = laydate.render({
                elem: '#log_endTime',
                done: function(value, date, endDate){
                    start.config.min = {
                        year: date.year,
                        month: date.month - 2,
                        date: date.date,
                    }; //结束日选好后，重置开始日的最大日期
                    start.config.max = {
                        year: date.year,
                        month: date.month - 1,
                        date: date.date,
                    }; //结束日选好后，重置开始日的最大日期
                }
            });


            form.on('submit(LAY-search-log)', function(obj){
                tableData(obj.field);
            });

            //关闭弹窗
            $(document).off('click', '#cancel');
            $(document).on('click', '#cancel', function () {
                layer.close(admin.popup.index);
            })

            function tableData(field){
                layer.closeAll('tips');
                table.render({
                    id: 'operationlog_'
                    ,elem: '#operationlog_'
                    ,url: setter.baseUrl + '/u-center/account/log' //模拟接口
                    ,page: setter.pageTable
                    ,cellMinWidth: 100
                    // ,loading: true
                    ,limit: setter.limit
                    ,response: setter.responseTable
                    ,cols: [[
                        {type: 'numbers',title:'序号',width: 60}
                        ,{field: 'created_at', width: 180, title: '时间'}
                        ,{field: 'mobile', width: 120, title: '账号'}
                        ,{field: 'user_name', width: 100, title: '姓名'}
                        ,{field: 'log_name', width: 150, title: '所属操作'}
                        ,{field: 'properties', width: 120, title: '操作类型', templet: '#optionType'}
                        ,{field: 'description', title: '详情'}
                    ]]
                    ,where: field
                    ,skin: 'line'
                });
            }
        })
    });
</script>
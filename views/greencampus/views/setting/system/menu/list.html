<!-- 菜肴管理 -->
<style>

</style>
<title>菜肴管理</title>
<div class="layui-fluid full-height">
    <div class="layui-card full-height over-auto">
        <div class="layui-card-header">菜肴管理</div>
        <div class="layui-card-body">
            <fieldset class="layui-elem-field">
                <legend>搜索条件</legend>
                <div class="layui-form">
                    <div class="layui-form-item">
                        <div class="layui-inline">

                            <!--   <div class="layui-form-item">
                                   <div class="layui-input-block pull-right">
                                           <button class="layui-btn " lay-submit="" lay-filter="delBat">批量删除</button>
                                           <button class="layui-btn " lay-submit="" lay-filter="newAdd">新增</button>
                                   </div>
                               </div>-->


                            <div class="layui-input-inline">
                                <script type="text/html" template
                                        lay-url="{{layui.setter.baseUrl}}/system/site/campuses"
                                        lay-done="{{layui.form.render()}}">

                                    <select name="campusId" id="menuListCampus" lay-filter="campus">
                                        <option value="" disabled selected>请选择校区</option>
                                        {{# layui.each(d.data, function(index, item){ }}
                                        <option value="{{item.id}}">{{item.name}}</option>
                                        {{# }); }}
                                    </select>
                                </script>
                            </div>
                            <div class="layui-input-inline">
                                <select name="canteenId" id="menuListcanteen">
                                    <option value="" disabled selected>请选择食堂</option>
                                </select>
                            </div>
                            <div class="layui-input-inline">
                                <input type="text" name="query" class="layui-input" placeholder="请输入关键字">
                            </div>
                            <div class="layui-input-inline">
                                <button class="layui-btn" lay-submit lay-filter="synchronous">菜品同步</button>
                                <button class="layui-btn" lay-submit lay-filter="search">查询</button>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
            <!--   <div class="layui-form-item">
                   <button class="layui-btn pull-right" id="synchronous">菜品同步</button>
               </div>-->
            <!-- 财务报表详情 -->
            <table class="layui-hide" id="menuListTable" lay-filter="menuListTable"></table>
            <!-- <script type="text/html" id="menuListToolbar">
                 <div class="layui-btn-container">
                  &lt;!&ndash;   <button class="layui-btn layui-btn-sm" lay-event="menuListDelete">批量删除</button>&ndash;&gt;
                     &lt;!&ndash;<button class="layui-btn layui-btn-sm" lay-event="menuListSignage">招牌菜设置</button>&ndash;&gt;
                     <button class="layui-btn layui-btn-sm" lay-event="menuListAdd">菜品同步</button>
                 </div>
             </script>-->

            <script type="text/html" id="menulistTool">
                <a class="layui-btn layui-btn-xs layui-btn " lay-event="menuDetail">编辑</a>
            </script>
        </div>
    </div>
</div>


<script>
    layui.use(['admin', 'form', 'table', 'laydate'], function () {
        var $ = layui.$,
            admin = layui.admin,
            view = layui.view,
            setter = layui.setter,
            form = layui.form,
            table = layui.table,
            upload = layui.upload,
            laydate = layui.laydate;

        $(function () {
            var cols = [[ //表头
                // {type: 'checkbox', fixed: 'left'}
                {
                    type: 'numbers', title: '序号', width: 60
                }
                , {field: 'name', title: '名称'}
                , {field: 'campusName', title: '校区'}
                , {field: 'canteenName', title: '食堂'}
                , {field: 'typeTitle', title: '分类'}
                , {field: 'eatTypeTitle', title: '标识'}
                , {field: 'sale_date', title: '销售时间'}
                , {field: 'price', title: '单价（元）'}
                , {field: 'stock', title: '库存'}
                , {
                    field: 'image_url', title: '轮播图', /*align:'center',*/ templet: function (d) {
                        return '<img width="30" height="30" src="' + d.image_url + '">';
                    }
                }

                , {title: '详情', align: 'center', toolbar: '#menulistTool'}
            ]]
            table.render(
                {
                    elem: '#menuListTable'
                    , url: setter.baseUrl + '/system/goods'
                    , response: setter.responseTable
                    , page: true //开启分页
                    , cols: cols
                }
            );
            //获取食堂
            form.on('select(campus)', function (data) {
                var campusId = data.value;
                admin.req({
                    url: setter.baseUrl + '/system/site/canteens',
                    type: 'get',
                    data: {campusId: campusId},
                    done: function (res) {
                        var _html = '<option value="" disabled selected>请选择食堂</option>';
                        $.each(res.data, function (i, k) {
                            _html += '<option value="' + k.id + '">' + k.name + '</option>'
                        })
                        $('#menuListcanteen').html(_html)
                        form.render();
                    }
                });
            });

            // var num = 5
            //点击搜索订单
            form.on('submit(synchronous)', function (obj) {
                // console.log(obj.field)
                admin.req({
                    url: setter.baseUrl + '/system/goods-sync'
                    , type: 'put'
                    , data: obj.field
                    , done: function (res) {
                        layer.msg(res.message, {icon: 1, time: 1000});
                    }
                });
            })
            form.on('submit(search)', function (obj) {
                console.log(obj);
                table.render({
                    elem: '#menuListTable'
                    , url: setter.baseUrl + '/system/goods'
                    , response: setter.responseTable
                    , page: true //开启分页
                    , cols: cols
                    , where: obj.field
                });
            });

            //头工具栏事件
            /*   table.on('toolbar(menuListTable)', function (obj) {
                   var checkStatus = table.checkStatus(obj.config.id);
                   var data = checkStatus.data;
                   console.log(data);
                   var order_ids = [];
                   data.forEach(function (res) {
                       order_ids.push(res.id)
                   });

                   console.log(order_ids);
                   switch (obj.event) {
                       case 'menuListDelete':
                           //申请结账还没写


                           break;
                       case 'menuListAdd':

                           break;
                  /!*     case 'menuListSignage':
                           admin.popupCenter({
                               id: 'LAY_adminispass',
                               title: '请选择招牌菜,最多选择' + num + '个',
                               area: ['436px', '360px'],
                               success: function () {
                                   view(this.id).render('/setting/system/menu/signage');
                               }
                           });
                           break;*!/
                   }
               });
   */

            // 点击编辑
            table.on('tool(menuListTable)', function (obj) {
                console.log(obj.data.id);
                layui.data('menuFoodsId', {
                    key: 'id',
                    value: obj.data.id
                });
                var layEvent = obj.event;
                if (layEvent === 'menuDetail') {
                    window.location.hash = '#/setting/system/menu/FoodsDetail';
                }
            });


            // 保存设置招牌菜


            /*   form.on('submit(signage_save)', function (data) {

               })*/

        });


    });
</script>
<!--  -->

<style>
    .content {
        min-height: 258px;
    }
</style>
<!-- 标准的弹框案例 -->
<div class="layui-form centerLayer" lay-filter="spwcialtyedit">
    <div class="content">
        <div class="layui-form-item">
            <label class="layui-form-label left">校区：</label>
            <div class="layui-input-block">
                <script type="text/html" template lay-url="{{layui.setter.baseUrl}}/system/site/campuses"
                        lay-done="layui.data.done(d)"
                >

                    <select name="campusId" id="campus" lay-filter="campus">
                        <option value="" disabled selected>请选择校区</option>
                        {{# layui.each(d.data, function(index, item){ }}
                        <option value="{{item.id}}">{{item.name}}</option>
                        {{# }); }}
                    </select>
                </script>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label left">食堂：</label>
            <div class="layui-input-block">
                <select name="canteenId" id="canteenser" lay-filter="canteenser">
                    <option value="" disabled selected>请选择食堂</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label left">菜品：</label>
            <div class="layui-input-block">
                <select name="idList" id="foods" lay-filter="foods">
                    <option value="" disabled selected>请选择菜品</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label left">排序：</label>
            <div class="layui-input-block">
                <input type="text" name="sort" lay-verify="required" autocomplete="off" placeholder="请输入排序"
                       class="layui-input">
            </div>
        </div>
    </div>
    <div class="layui-form-item p-t-10 ft-center">
        <button class="layui-btn" lay-submit lay-filter="LAY-edit-ensure">确定</button>
        <button class="layui-btn layui-btn-primary" id="cancel">取消</button>
    </div>
</div>


<script>
    layui.data.done = function (d) {
        layui.use(['admin', 'form'], function () {
            var $ = layui.$,
                admin = layui.admin,
                setter = layui.setter,
                view = layui.view,
                distpicker = layui.distpicker,
                form = layui.form;

            $(function () {
                form.render();
                var id = layui.data('specialtyId').id;
                admin.req({
                    url: setter.baseUrl + '/system/goods/' + id,
                    type: 'GET',
                    data: {},
                    done: function (res) {
                        //表单初始赋值
                        var campus_id = res.data.canteen.campus_id;
                        form.val('spwcialtyedit', {
                            'campusId': campus_id,
                            // 'name': res.data.id,
                            'sort': res.data.specialty_sort
                        });

                        if (campus_id) {
                            admin.req({
                                url: setter.baseUrl + '/system/site/canteens',
                                type: 'get',
                                data: {campusId: campus_id},
                                done: function (respon) {
                                    var _html = '<option value="" disabled selected>请选择食堂</option>';
                                    $(respon.data).each(function (i, k) {
                                        _html += '<option value="' + k.id + '">' + k.name + '</option>'
                                    })
                                    $('#canteenser').html(_html);
                                    form.render();
                                    var canteen_id = res.data.canteen_id
                                    form.val('spwcialtyedit', {
                                        'canteenId': canteen_id
                                    });
                                    if (canteen_id) {
                                        admin.req({
                                            url: setter.baseUrl + '/system/goods',
                                            type: 'get',
                                            data: {canteenId: canteen_id, campusId: campus_id},
                                            done: function (data) {
                                                var _html = '<option value="" disabled selected>请选择菜品</option>';
                                                $(data.data).each(function (i, k) {
                                                    _html += '<option value="' + k.id + '">' + k.name + '</option>'
                                                })
                                                $('#foods').html(_html)
                                                form.render();
                                                form.val('spwcialtyedit', {
                                                    'idList': res.data.id
                                                });
                                            }
                                        });
                                    }
                                }
                            });
                        }

                    }
                });


            });
            
            // 取消事件
            $(document).off('click','#cancel');
            $(document).on('click','#cancel',function(){
                layer.closeAll();
            });



        });
    }
</script>


<!-- 签单单位编辑 -->
<style>
    .wrapper .layui-input-inline {
            margin-bottom: 12px;
        }
        .wrapper .header {
            padding-left: 10px;
            border-left: 4px solid #06ccc5;
            line-height: 1;
            color: #999;
            margin-bottom: 20px;
            margin-top: 30px;
        }
    
            .btn-bar {
            background: #f7f8fa;
            padding: 4px 10px;
        }
        .active{
            background: #F6F6F6 ;
    }
    .pay .list-wrapper li {
        padding: 6px;
        line-height: 30px;
    }
    </style>
<title>签单单位详情</title>
<div class='wrapper layui-fluid full-height '>
    <div class='layui-card full-height over-auto'>
        <!-- //上面的head，标题 -->
        <div class="layui-card-header">签单单位详情</div>
        <!-- //content身体部分 -->
        <div class='layui-card-body'>
            <div class="layui-form layui-form-pane" lay-filter="eadit">
                <div class="layui-form-item">
                    <div class="layui-block" pane>
                        <label class="layui-form-label">所属校区</label>
                        <div class="layui-input-block">
                            <script type="text/html" template lay-url="{{layui.setter.baseUrl}}/system/site/campuses"
                                lay-done="layui.data.done(d)">
                                <select id= "campusId" name="campusId" id="" lay-filter="campus" >
                                    <option value="" disabled selected>请选择校区</option>
                                    {{#
                                    layui.each(d.data, function(index, item){
                                    }}
                                    <option value="{{item.id}}">{{item.name}}</option>
                                    {{# }) }}
                                </select>
                            </script>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-block" pane>
                        <label class="layui-form-label">名称</label>
                        <div class="layui-input-block">
                            <input type="text" name="designation" value="" class="layui-input" placeholder="请输入单位名称">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-block" pane>
                        <label class="layui-form-label">联系人</label>
                        <div class="layui-input-block">
                            <input type="text" name="contactName" class="layui-input" placeholder="联系人">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-block" pane>
                        <label class="layui-form-label">联系电话</label>
                        <div class="layui-input-block">
                            <input type="text" name="contactPhone" class="layui-input mobil" placeholder="联系电话">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-block" pane>
                        <label class="layui-form-label">单位简介</label>
                        <div class="layui-input-block">
                            <input type="text" name="summary" class="layui-input" placeholder="单位简介">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-block" pane>
                        <label class="layui-form-label">备注</label>
                        <div class="layui-input-block">
                            <input type="text" name="remark" class="layui-input" placeholder="备注">
                        </div>
                    </div>
                </div>
                <!-- 确定和取消按钮 -->
                <div class="layui-input-inline ">
                    <button class="layui-btn" lay-submit id="confirm" lay-filter="KEY-confirm">保存</button>
                    <button class="layui-btn" lay-submit id='KEY-cancel' lay-filter="KEY-cancel">取消</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    layui.data.done = function (d) {
        layui.use(['admin', 'form', 'laydate', 'table'], function () {
            var $ = layui.$,
                admin = layui.admin,
                table = layui.table,
                view = layui.view,
                setter = layui.setter,
                form = layui.form,
                laydate = layui.laydate,
                upload = layui.upload;

            $(function () {
                // 编辑的初始化
                getDefaulVal();
                function getDefaulVal() {
                    // var id = layui.data('menuFoodsId').id
                    admin.req({
                        url: setter.baseUrl + '/system/site/unit/' + layui.data('orderIdd').id,
                        type: 'GET',
                        data: {},
                        done: function (res) {
                            //表单初始赋值
                            form.val('eadit', {
                                "campusId": res.data.campus_id,
                                "name": res.data.name,
                                "contactName": res.data.contact_name,
                                "contactPhone": res.data.contact_phone,
                                "summary": res.data.summary,
                                "remark": res.data.remark,
                            })
                        }
                    });
                }




                form.on('submit(KEY-confirm)', function (obj) {

                    var designation = $('input[name= "designation"]').val();
                    var contactName = $('input[name= "contactName"]').val();
                    var contactPhone = $('input[name= "contactPhone"]').val();
                    var summary = $('input[name= "summary"]').val();
                    var remark = $('input[name= "remark"]').val();
                      // 手机号正则表达式处理
                      function codeVerification(phone) {
                        let phoneCodeVerification = /^[1][3,4,5,7,8][0-9]{9}$/;
                        return phoneCodeVerification.test(phone);
                    }
                    var contactPhone = $('.mobil').val();
                    if (!codeVerification(contactPhone)) {
                        layer.msg('您的手机号码不正确，请重新填写！', { icon: 2, time: 3000 });
                        return false;
                    }



                    // 校区
                    var campus = $('#campusId option:selected').text();
                    if (!designation) {
                        layer.msg("请输入名称", { icon: 2, time: 2000 });
                    } else if (!contactName) {
                        layer.msg("请输入联系人", { icon: 2, time: 2000 });
                    } else if (!contactPhone) {
                        layer.msg("请输入联系电话", { icon: 2, time: 2000 });
                    } else if (!summary) {
                        layer.msg("请输入单位简介", { icon: 2, time: 2000 });
                    } else if (!remark) {
                        layer.msg("请输入备注", { icon: 2, time: 2000 });
                    }
                    else if (campus == "请选择校区") {
                        layer.msg("请选择所选所属校区", { icon: 2, time: 2000 });
                    } else {
                        var data = {};
                        data = obj.field;
                        admin.req({
                            url: setter.baseUrl + '/system/site/unit/' + layui.data('orderIdd').id
                            , type: 'put'
                            , data: data
                            , done: function (res) {
                                view('old_mobile')
                                layer.msg(res.message, { icon: 1, time: 2000 });
                                layer.close(admin.closeThisTabs());//关闭右侧面板  
                                window.location.hash = '#/setting/system/sign-bill/unit';
                                layer.closeAll();
                            }
                        });
                    }
                });

                $(document).on('click', '#KEY-cancel', function () {
                    window.location.hash = '#/setting/system/sign-bill/unit';
                });
            });
        });
    }
</script>
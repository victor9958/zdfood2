<!-- 签单单位 -->
<style>
    .btn-bar {
        background: #f7f8fa;
        padding: 4px 10px;
    }
</style>
<title>签单单位</title>
<div class="layui-fluid full-height">
    <div class="layui-card full-height over-auto">
        <div class="layui-card-header">签单单位</div>
        <div class="layui-card-body">
            <fieldset class="layui-elem-field">
                <legend>搜索条件</legend>
                <div class="layui-form">
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <div class="layui-input-inline">
                                <input type="text" name="query" class="layui-input" autocomplete="off" placeholder="请输入关键字">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <button class="layui-btn" lay-submit lay-filter="search">查询</button>
                        </div>
                    </div>
                </div>
            </fieldset>
            <div class="m-b-10 btn-bar">
                <button class="layui-btn layui-btn-sm" id="addunit">添加</button>
            </div>
            <!-- 财务报表详情 -->
            <table class="layui-hide" id="repUnit" lay-filter="repUnit"></table>
            <script type="text/html" id="particulars">
                <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a> 
                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
            </script>
        </div>
    </div>
</div>
<script>
    layui.use(['admin', 'form', 'table', 'laydate'], function () {
        var $ = layui.$,
            admin = layui.admin,
            view = layui.view,
            setter = layui.setter,
            form = layui.form,
            laydate = layui.laydate,
            table = layui.table,
            upload = layui.upload,
            laydate = layui.laydate;
        $(function () {
            var cols = [[ //表头
                { type: 'numbers', title: '序号', width: 60}
                , { field: 'name', title: '单位名称' }
                , { field: 'contact_name', title: '联系人' }
                , { field: 'contact_phone', title: '联系电话' }
                , { title: '操作', align: 'center', toolbar: '#particulars' }
            ]];
            getRtable();
            function getRtable() {
                table.render(
                    {
                        elem: '#repUnit'
                        , url: setter.baseUrl + '/system/site/units'
                        , response: setter.responseTable
                        , page: setter.pageTable
                        , cols: cols
                    }
                );
            }
            // 时间控件
            laydate.render({
                elem: '#orderListdate' //指定元素
                , type: 'date'
                , range: '-'
                , done: function (value, date, endDate) {
                    console.log(value);
                    var beginTime = value.split(' - ')[0];
                    var endTime = value.split(' - ')[1];
                    $('#orderListStartTime').val(beginTime);
                    $('#orderListEndTime').val(endTime);
                }
            });
            //点击搜索订单
            form.on('submit(search)', function (obj) {
                console.log(obj);
                table.reload('repUnit', {
                    url: setter.baseUrl + '/system/site/units',
                    response: setter.responseTable,
                    page: setter.pageTable,
                    cols: cols,
                    where: obj.field
                });
            });

            // 添加事件
            $(document).off('click', '#addunit');
            $(document).on('click', '#addunit', function () {
                // 跳转到添加事件
                window.location.hash = '#/setting/system/sign-bill/unitXq';
            });
            // 监听工具条的点击事件
            table.on('tool(repUnit)', function (obj) {
                var data = obj.data;
                var layEvent = obj.event;
                var tr = obj.tr;
                console.log(obj.data.id);
                layui.data('orderIdd', {
                    key: 'id',
                    value: obj.data.id
                });
                if (layEvent === 'edit') { //编辑
                    window.location.hash = '#/setting/system/sign-bill/uniedit';
                } else if (layEvent == 'del') {//删除
                    var idList = data.id;
                    admin.req({
                        url: setter.baseUrl + '/system/site/units'
                        , type: 'delete'
                        , data: { 'idList': [idList] }
                        , done: function (res) {
                            view('old_mobile')
                            layer.msg(res.message, { icon: 1, time: 2000 });
                            layer.close(admin.popup.index);//关闭右侧面板
                            getRtable();
                        }
                    });

                }
            });
        });
    });
</script>
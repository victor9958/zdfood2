<!-- 编辑 -->

<!-- 添加用户 -->

<!-- 标准的弹框案例 -->
<div class="layui-form centerLayer" lay-filter="FoodsDetail">
    <div class="layui-form-item">
        <label class="layui-form-label left">姓名：</label>
        <div class="layui-input-block">
            <input type="text" name="username" lay-verify="required" autocomplete="off" placeholder="请输入姓名" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label left">手机：</label>
        <div class="layui-input-block">
            <input type="text" name="mobile" lay-verify="required" autocomplete="off" placeholder="请输入手机" class="layui-input mobil">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label left">工号：</label>
        <div class="layui-input-block">
            <input type="text" name="jobNo" lay-verify="required" autocomplete="off" placeholder="请输入工号" class="layui-input">
        </div>
    </div>

   <!-- <div class="layui-form-item">
        <label class="layui-form-label left">密码：</label>
        <div class="layui-input-block">
            <input type="password" name="password" lay-verify="required" autocomplete="off" placeholder="请输入密码" class="layui-input Pass">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label left">确定密码：</label>
        <div class="layui-input-block">
            <input type="password" name="password" lay-verify="required" autocomplete="off" placeholder="请输入确定密码" class="layui-input newPass">
        </div>
    </div>-->

    <div class="layui-form-item">
        <label class="layui-form-label left">校区：</label>
        <!-- <div class="layui-input-block">
                <input type="text" name="campusId" lay-verify="required" autocomplete="off" placeholder="请输入校区" class="layui-input">
            </div> -->
        <div class="layui-input-block">
            <script type="text/html" template lay-url="{{layui.setter.baseUrl}}/system/site/campuses" lay-done="layui.data.done(d)">

                    <select name="campusId" id="campus" lay-filter="campus">
                        <option value="" disabled selected>请选择校区</option>
                        {{# layui.each(d.data, function(index, item){ }}
                        <option value="{{item.id}}">{{item.name}}</option>
                        {{# }); }}
                    </select>
                </script>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label left">食堂：</label>
        <div class="layui-input-block">
            <!-- <script type="text/html" template lay-url="{{layui.setter.baseUrl}}/system/site/canteen/" lay-done="{{layui.form.render()}}"> -->
            <select name="canteenId" id="canteenser_V" lay-filter="canteenser">
                <option value="" disabled selected>请选择食堂</option>
            </select>
            <!-- <select name="canteenId" id="canteenser" lay-filter="canteenser">
                            <option value="" disabled selected>请选择食堂</option>
                            {{# layui.each(d.data, function(index, item){ }}
                            <option value="{{item.id}}">{{item.name}}</option>
                            {{# }); }}
                        </select> -->

            <!-- </script> -->
        </div>
    </div>

    <div class="layui-form-item p-t-10 ft-center">
        <button class="layui-btn" lay-submit lay-filter="LAY-add-editmin">确定</button>
        <button class="layui-btn layui-btn-primary" id="cancel">取消</button>
    </div>
</div>




<script>
    layui.data.done = function (d) {
        layui.use(['admin', 'form', 'laydate', 'table'], function () {
            var $ = layui.$,
                admin = layui.admin,
                table = layui.table,
                view = layui.view,
                setter = layui.setter,
                form = layui.form,
                laydate = layui.laydate,
                upload = layui.upload;

            getDefaulVal()

            function getDefaulVal() {
                var id = layui.data('authorityUser').userList;
                admin.req({
                    url: setter.baseUrl + '/system/account/admin/' + id,
                    type: 'GET',
                    data: {},
                    done: function (res) {
                        //表单初始赋值
                        var campusId = res.data.campus_id;
                        if (campusId) {
                            admin.req({
                                url: setter.baseUrl + '/system/site/canteens',
                                type: 'get',
                                data: { campusId: campusId },
                                done: function (data) {
                                    var _html = '<option value="" disabled selected>请选择食堂</option>';
                                    $(data.data).each(function (i, k) {
                                        _html += '<option value="' + k.id + '">' + k.name + '</option>'
                                    })
                                    $('#canteenser_V').html(_html);

                                    form.val('FoodsDetail', {
                                        "canteenId": res.data.canteen_id,
                                    })
                                    form.render();

                                }
                            });

                        }
                        form.val('FoodsDetail', {
                            "username": res.data.name,
                            "mobile": res.data.mobile,
                            "jobNo": res.data.job_no,
                            // "password": res.data.password,
                            "campusId": res.data.campus_id,
                        })
                    }
                });
            }

            // 确定按钮
            form.on('submit(LAY-add-editmin)', function (obj) {
                // 手机号正则表达式处理
                function codeVerification(phone) {
                    let phoneCodeVerification = /^[1][3,4,5,7,8][0-9]{9}$/;
                    return phoneCodeVerification.test(phone);
                }
                var mobilb = $('.mobil').val();
                if (!codeVerification(mobilb)) {
                    layer.msg('您的手机号码不正确，请重新填写！', { icon: 2, time: 3000 });
                    return false;
                }
                // 判断两个密码是否相等
                var newPass = $('.newPass').val();
                var Pass= $('.Pass').val();
                


                var id = $('#payList .active').attr('data-id');
                var data = {};
                data = obj.field;
                data.roleId = id
                //请求添加部门接口
                if(newPass == Pass){
                        admin.req({
                        url: setter.baseUrl + '/system/account/admin/' + layui.data('authorityUser').userList
                        , type: 'put'
                        , data: data
                        , done: function (res) {
                            view('old_mobile')
                            layer.msg(res.message, { icon: 1, time: 2000 });
                            layer.close(admin.popup.index);//关闭右侧面板
                            getDefaulVal(id);
                        }
                    });
                }else {
                    layer.msg('您的两次密码输入不一致，请重新填写！', { icon: 2, time: 3000 });
                }
               
            });

            $(document).off('click', '#cancel');
            $(document).on('click', '#cancel', function () {
                layer.closeAll();
            });
        });
    }
</script>
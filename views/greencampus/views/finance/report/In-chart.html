<style>
    .bag {
    background-color: #14DDD6;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    text-align: center;
    line-height: 80px;;
    }
    .bmry {
        width: 40px;
    height: 40px;
        color: #fff;
        display: inline-block;
        font-size: 80px;
    }
    .indent {
        font-size: 40px;
        padding-top: 10px;
        display: inline-block;
    }
    .algin-center {
        margin: 30px 85px 60px 52px;
    }
    .main {
        padding: 30px 50px;
    }
    .bot-margin {
        margin-top: 5px;
        margin-bottom: 130px;
    }
    </style>

<script type="text/html" template>
    <link rel="stylesheet" href="{{ layui.setter.base }}style/index.css?v={{ layui.admin.v }}-1" media="all">
</script>
<div class="index">
    <div class="layui-row full-height">
        <!-- <div class="layui-card main full-height"> -->


        <div class=" chart-box">
            <div class="p-r-6">
                <div class="flex flex-v height300">
                    <!-- <div class="flex flex-align-center m-b-10">
                                    <p class="flex-1">近7天订单数据</p>
                                </div> -->
                    <div class="echarts_elem_v flex-1 full-height"></div>
                    <div class="echarts_empty_v ft-gray"></div>
                </div>
            </div>

        </div>
        <div class="layui-form-item p-t-10 ft-center">
            <button class="layui-btn" lay-submit lay-filter="LAY-add-ensure" id="ensureOff-in">确定</button>
            <button class="layui-btn layui-btn-primary" id="ensureOff-in">取消</button>
        </div>
        <!-- </div> -->
    </div>
</div>


<script>
    layui.use(['echarts', 'form', 'table', 'laydate'], function () {
        var $ = layui.$
            , echarts = layui.echarts
            , setter = layui.setter
            , admin = layui.admin
            , table = layui.table
            , laydate = layui.laydate
            , form = layui.form;

        var countType = '', operatorId = '';
        var query = {};
        var echartsApp = [], options = []
            , elemDataView = $('.echarts_elem_v')
            , renderDataView = function (index) {
                echartsApp[index] = echarts.init(elemDataView[index], layui.echartsTheme);
                echartsApp[index].setOption(options[index]);
            };


        //没找到DOM，终止执行
        if (!elemDataView[0]) return;
        // renderDataView(0);
        // renderDataView(1);
        // renderDataView(2);
        // renderDataView(3);

        $(window).resize(function () {
            $.each(echartsApp, function (i, k) {
                echartsApp[i].resize();
            })
        })



   var campus_id = layui.data('campus_id').id;
   var meal_type = layui.data('meal_type').id;
   var end_time = layui.data('end_time').id;
   var start_time = layui.data('start_time').id;
        function dataPie(data) {
            // if(countType){
            //     delete data.countType
            // }
            admin.req({
                url: setter.baseUrl + '/finance/order-rate-img'
                , type: 'get'
                , data: { 'campus_id': campus_id,'meal_type':meal_type,'end_time':end_time,'start_time':start_time, 'eat_type': 2 }
                , done: function (res) {
                    if (res.data.length === 0) {
                        $('.echarts_empty_v').eq(1).html('该时间暂无数据').show().siblings().hide();
                    } else {
                        options[0] = {
                            tooltip: {
                                trigger: 'item',
                                formatter: "{a} <br/>{b}: {c}笔 ({d}%)"
                            },

                            color: ['rgb(255,219,92)', 'rgb(103,224,227)'],

                            // legend: {
                            //     orient: 'vertical',
                            //     left: 'left',
                            //     data: ['直接访问','邮件营销','联盟广告','视频广告','搜索引擎']
                            // },
                            series: [
                                {
                                    name: '堂食统计',
                                    type: 'pie',
                                    radius: '60%',
                                    avoidLabelOverlap: false,
                                    label: {
                                        normal: {
                                            show: true,
                                            position: 'outside',
                                            formatter: function (param) {

                                                var str = param.name + '\n' + param.value + '笔';
                                                return str
                                            }
                                        },
                                        emphasis: {
                                            show: true,
                                            textStyle: {
                                                fontSize: '20',
                                            }
                                        }
                                    },
                                    labelLine: {
                                        normal: {
                                            show: false
                                        }
                                    },
                                    data: res.data

                                }
                            ]
                        }
                        renderDataView(0);
                        $('.echarts_empty_v').eq(0).hide().siblings().show();
                    }

                }
            })
        }

        // dataBar();
        dataPie();


        //监听侧边伸缩
        layui.admin.on('side', function () {
            setTimeout(function () {
                $.each(echartsApp, function (i, k) {
                    echartsApp[i].resize();
                })
            }, 300);
        });
        $(document).off('click','#ensureOff-in');
        $(document).on('click','#ensureOff-in',function(){
            layer.closeAll();
        });

    });
</script>
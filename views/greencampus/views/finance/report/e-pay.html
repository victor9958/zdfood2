<!-- 电子支付统计 -->
<style>
    .btn-bar {
        background: #f7f8fa;
        padding: 4px 10px;
    }
    .ml {
        margin-left: 10px;
    }
</style>
<title>电子支付统计</title>
<div class="layui-fluid full-height">  
    <div class="layui-card full-height over-auto">
        <div class="layui-card-header">电子支付统计</div>
        <div class="layui-card-body">
            <fieldset class="layui-elem-field">
                <legend>搜索条件</legend>
                <div class="layui-form">
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <div class="layui-input-inline">
                                <input type="text" class='layui-input' name="name_or_mobile" placeholder="请输入姓名">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <button class="layui-btn" lay-submit lay-filter="search">查询</button>
                            <!-- <script type="text/html" template>
                                <a href="{{layui.setter.baseUrl}}/finance/electronic-all-statistics-export?Authorization={{layui.data('layuiAdmin').Authorization}}"
                                class="layui-btn  ml">导出</a>
                            </script> -->

                            <a href="javascript:;" class="layui-btn layui-btn-normal" lay-submit lay-filter="LAY-report-e-pay">导出Excel</a>
                        </div>
                    </div>
                </div>
            </fieldset>
            <!-- <div class="m-b-10 btn-bar">
                
            </div> -->
            <!-- 财务报表详情 -->
            <table class="layui-hide" id="repEpay" lay-filter="repEpay"></table>
            <script type="text/html" id="particulars">
                <a class="layui-btn layui-btn-xs" lay-event="detail">详情</a>
            </script>
        </div>
    </div>
</div>
<script type="text/html" id="orderOperate">
    <a class="layui-btn layui-btn-xs layui-btn-primary" lay-event="detail">详情</a>
</script>
<script>
    layui.use(['admin', 'form', 'table', 'laydate'], function () {
        var $ = layui.$,
            admin = layui.admin,
            view = layui.view,
            setter = layui.setter,
            form = layui.form,
            laydate = layui.laydate,
            table = layui.table,
            upload = layui.upload,
            laydate = layui.laydate;
        $(function () {
            var cols = [[ //表头
                { field: 'user_name', title: '用户名' }
                , { field: 'order_count', title: '订单数' }
                , { field: 'price_count', title: '总金额' }
                , { title: '操作', align: 'center', toolbar: '#particulars' }
            ]];
            table.render(
                {
                    elem: '#repEpay'
                    , url: setter.baseUrl + '/finance/electronic-all-statistics'
                    , response: setter.responseTable
                    , page: setter.pageTable
                    , cols: cols
                }
            );
            //点击搜索订单
            form.on('submit(search)', function (obj) {
                console.log(obj);
                table.reload('repEpay', {
                    url: setter.baseUrl + '/finance/electronic-all-statistics',
                    response: setter.responseTable,
                    page: setter.pageTable,
                    cols: cols,
                    where: obj.field
                });
            });
            // // 监听工具条的点击事件
            table.on('tool(repEpay)', function (obj) {
                var data = obj.data;
                var layEvent = obj.event;
                var tr = obj.tr;

                console.log(obj.data.user_id);
                layui.data('orderpayxqId', {
                    key: 'id',
                    value: obj.data.user_id
                });

                if (layEvent === 'detail') { //查看detail
                    window.location.hash = '#/finance/report/e-payXq';
                }
            });

             function deviceExport(filter, url, deviceType) {
                form.on(filter, function (obj) {
                    console.log(obj);
                    var href = setter.baseUrl + url + '?Authorization=' + layui.data('layuiAdmin').Authorization + '&name_or_mobile=' +
                        obj.field.name_or_mobile ;
                    window.location.href = href;
                });
            };
            deviceExport('submit(LAY-report-e-pay)', '/finance/electronic-all-statistics-export', 3);

            //  deviceExport('submit(LAY-report-month-print)', '/finance/sign-month-statistics-print', 3);
        });
    });
</script>
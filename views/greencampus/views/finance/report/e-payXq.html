<!-- 电子支付统计详情 -->
<style>
    .information {
        margin-top: 10px;
        line-height: 2;
        padding-left: 12px;
    }
     .information .left_txt {
        width: 120px;
        color: #333;
    }
    .btn-bar {
        background: #f7f8fa;
        padding: 4px 10px;
    }
    .ml {
        margin-left: 10px;
    }
</style>
<title>电子支付统计详情</title>
<div class="layui-fluid full-height">
    <div class="layui-card full-height over-auto">
        <div class="layui-card-header">详情</div>
        <div class="layui-card-body">
            <div class="layui-form">
                <div class="layui-form-item">
                    <div class="layui-block layui-form-item ">
                        <script type="text/html" template lay-url="{{layui.setter.baseUrl}}/finance/electronic-statistics-detail/{{layui.data('orderpayxqId').id}}">
                            <div  class='information layui-clear'>
                                <div class="layui-col-md5 pull-left flex">
                                    <div class="left_txt">订餐人：</div>
                                    <div class="flex-1">{{d.user.name}}</div>
                                </div>
                                <div class="layui-col-md7 pull-left flex">
                                    <div class="left_txt">已付金额：</div>
                                    <div class="flex-1">￥{{d.user.yes}}</div>
                                </div>
                                <div class="layui-col-md5 pull-left flex">
                                    <div class="left_txt">手机号</div>
                                    <div class="flex-1">{{d.user.mobile}}</div>
                                </div>
                                <div class="layui-col-md7 pull-left flex">
                                    <div class="left_txt">未付金额：</div>
                                    <div class="flex-1">￥{{d.user.no}}</div>
                                </div>
                                <div class="layui-col-md5 pull-left flex">
                                    <div class="left_txt">学工号：</div>
                                    <div class="flex-1">{{d.user.job_no}}</div>
                                </div>
                            </div>
                        </script>
                    </div>
                </div>
                <div class="m-b-10 btn-bar">
                    <div class="layui-input-inline">
                        <input type="text" class="layui-input time" id="orderpayxqdate-e-payXq" placeholder="请选择开始时间和结束时间">
                        <input type="hidden" name="start_time" id="orderpayxqStartTime-e-payXq" value="">
                        <input type="hidden" name="end_time" id="orderpayxqEndTime-e-payXq" value="">
                    </div>
                    <button class="layui-btn ml layui-btn-sm" id='' lay-submit lay-filter='LAY-payxq-search'>查询</button>
                    <!-- <script type="text/html" template>
                        <a href="{{layui.setter.baseUrl}}/finance/electronic-statistics-detail-export/{{layui.data('orderpayxqId').id}}?Authorization={{layui.data('layuiAdmin').Authorization}}"
                        class="layui-btn layui-btn-sm ml">导出</a>
                    </script> -->
                    <a href="javascript:;" class="layui-btn layui-btn-normal" lay-submit lay-filter="LAY-report-e-payXq">导出Excel</a>
                </div>
                <!-- 财务报表详情 -->
                <table class="layui-hide" id="repTxq" lay-filter="repTxq"></table>
            </div>
        </div>
    </div>
</div>
<script type="text/html" id="orderOperate">
    <a class="layui-btn layui-btn-xs layui-btn-primary" lay-event="detail">详情</a>
</script>
<script>
    layui.use(['admin', 'form', 'table', 'laydate'], function () {
        var $ = layui.$,
            admin = layui.admin,
            view = layui.view,
            setter = layui.setter,
            form = layui.form,
            table = layui.table,
            upload = layui.upload,
            laydate = layui.laydate;
        $(function () {
            var cols = [[ //表头
                {
                    field: 'repast_at', title: '日期', templet: function (d) {
                        if (d.created_at == null) {
                            return ''
                        } else {
                            return d.created_at.split(' ')[0]
                        }
                    }
                },
                { field: 'order_sn', title: '单号' }
                , { field: 'meal_type_name', title: '餐别' }
                , { field: 'meal_type', title: '订餐份数' }
                , { field: 'discount_price', title: '总金额' }
                , { field: 'pay_status_name', title: '付款情况' }
            ]];
            table.render(
                {
                    elem: '#repTxq'
                    , url: setter.baseUrl + '/finance/electronic-statistics-detail/' + layui.data('orderpayxqId').id
                    , response: setter.responseTable
                    , page: setter.pageTable
                    , cols: cols
                }
            );
            laydate.render({
                elem: '#orderpayxqdate-e-payXq' //指定元素
                , type: 'date'
                , range: '-'
                , done: function (value, date, endDate) {
                    console.log(value);
                    // 获取到的日期格式进行分割2018-10-09 - 2018-11-21
                    var beginTime = value.split(' - ')[0];
                    var endTime = value.split(' - ')[1];
                    $('#orderpayxqStartTime-e-payXq').val(beginTime);
                    $('#orderpayxqEndTime-e-payXq').val(endTime);
                }
            });
            form.on('submit(LAY-payxq-search)', function (obj) {
                console.log(obj);
                table.reload('repTxq', {
                    url: setter.baseUrl + '/finance/electronic-statistics-detail/' + layui.data('orderpayxqId').id,
                    response: setter.responseTable,
                    page: setter.pageTable,
                    cols: cols,
                    where: obj.field
                });
            });

             function deviceExport(filter, url, deviceType) {
                form.on(filter, function (obj) {
                    console.log(obj);
                    var href = setter.baseUrl + url +'/'+layui.data('orderpayxqId').id+ "?Authorization=" + layui.data('layuiAdmin').Authorization + '&start_time=' +
                        obj.field.start_time + '&end_time=' + obj.field.end_time;
                        alert(href);
                    window.location.href = href;
                });
            };
            deviceExport('submit(LAY-report-e-payXq)', '/finance/electronic-statistics-detail-export', 3);
        });
    });
</script>